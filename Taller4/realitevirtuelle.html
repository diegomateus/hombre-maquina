<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
		<script src="DeviceOrientationControls.js"></script>
		<script src="StereoEffect.js"></script>
		<script>

			var mouse = new THREE.Vector2();
			var raycaster = new THREE.Raycaster();

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );


			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );
			var effect = new THREE.StereoEffect(renderer);
			effect.setSize(window.innerWidth, window.innerHeight);

			camera.position.y = 1.6;


			var light = new THREE.PointLight( 0xffffff, 1, 100 );
			light.position.set( 0, 5, 0 );
			scene.add( light );

			var loader = new THREE.TextureLoader();

			var textureFloor = loader.load("floor.jpg");
			var geometryFloor = new THREE.PlaneGeometry( 5, 5 );
			var materialFloor = new THREE.MeshStandardMaterial( {map: textureFloor} );
			var floor = new THREE.Mesh( geometryFloor, materialFloor );
			floor.rotation.x = -1.5708;
			floor.position.set(0,0,0);
			scene.add( floor );

			var textureCeilling = loader.load("wall.jpg");
			var geometryCeilling = new THREE.PlaneGeometry( 5, 5 );
			var materialCeilling = new THREE.MeshStandardMaterial( {map: textureCeilling} );
			var ceilling = new THREE.Mesh( geometryCeilling, materialCeilling );
			ceilling.rotation.x = -1.5708;
			ceilling.position.y = 3;
			ceilling.rotation.z = -3.1415;
			scene.add( ceilling );

			var textureWall = loader.load("wall.jpg");
			var geometryWall = new THREE.PlaneGeometry( 5, 3 );
			var materialWall = new THREE.MeshStandardMaterial( {map: textureWall} );
			var wall = new THREE.Mesh( geometryWall, materialWall );

			wall.position.y = 1.5;
			wall.position.z = -2.5;
			scene.add( wall );

			var geometryWall1 = new THREE.PlaneGeometry( 5, 3 );
			var materialWall1 = new THREE.MeshStandardMaterial( {map: textureWall} );
			var wall1 = new THREE.Mesh( geometryWall1, materialWall1 );

			wall1.rotation.y = 1.5708;
			wall1.position.y = 1.5;
			wall1.position.x = 2.5;
			scene.add( wall1 );

			var geometryWall2 = new THREE.PlaneGeometry( 5, 3 );
			var materialWall2 = new THREE.MeshStandardMaterial( {map: textureWall} );
			var wall2 = new THREE.Mesh( geometryWall2, materialWall2 );

			wall2.rotation.y = 1.5708;
			wall2.position.y = 1.5;
			wall2.position.x = -2.5;
			scene.add( wall2 );

			var geometryWall3 = new THREE.PlaneGeometry( 5, 3 );
			var materialWall3 = new THREE.MeshStandardMaterial( {map: textureWall} );
			var wall3 = new THREE.Mesh( geometryWall3, materialWall3 );

			wall3.position.y = 1.5;
			wall3.position.z = 2.5;
			scene.add( wall3 );

			var geometrySwitch = new THREE.BoxGeometry( 0.25, 0.4, 0.1);
			var materialSwitch =  new THREE.MeshStandardMaterial({ color: 0x94a0d1});
			var interruptor = new THREE.Mesh( geometrySwitch, materialSwitch);
			interruptor.position.set(0,1,-2.5);
			scene.add(interruptor);

			var geometrySwitch2 = new THREE.BoxGeometry( 0.12, 0.2, 0.05);
			var materialSwitch2 =  new THREE.MeshStandardMaterial({ color: 0xc0c9eb});
			var interruptor2 = new THREE.Mesh( geometrySwitch2, materialSwitch2);
			interruptor2.position.set(0,1,-2.4);
			interruptor2.name = "switch";

			scene.add(interruptor2);
			var isPrendido = true;


			function animate() {
				requestAnimationFrame( animate );
				//renderer.render( scene, camera );
				effect.render(scene, camera);
				raycaster.setFromCamera( mouse, camera);
				var intersects = raycaster.intersectObjects(scene.children,true);
				if(intersects.length>0){
              if(intersects[0].object.name=="switch"){
								isPrendido = !isPrendido;
								light.visible = isPrendido;
              }
        }
			}
			animate();

			document.addEventListener("keypress", function(event){
				 var x = event.key;
				 if(x == 'a' || x == 'A'){
					 camera.position.x -= 0.05;
				 }
				 if(x == 'd' || x == 'D'){
					 camera.position.x += 0.05;
				 }
				 if(x == 'w' || x == 'W'){
					 camera.position.z -= 0.05;
				 }
				 if(x == 's' || x == 'S'){
					 camera.position.z += 0.05;
				 }
				 if(x == 'e' || x == 'E'){
					 camera.position.y += 0.05;
				 }
				 if(x == 'q' || x == 'Q'){
					 camera.position.y -= 0.05;
				 }

				 if(x == '8'){
					 camera.rotation.x += 0.05;
				 }
				 if(x == '2'){
					 camera.rotation.x -= 0.05;
				 }
				 if(x == '6'){
					 camera.rotation.y -= 0.05;
				 }
				 if(x == '4'){
					 camera.rotation.y += 0.05;
				 }

				 if(x == 'c' || x == 'C'){
					 alert("camera at \nx: "+camera.position.x.toFixed(3)
					 			+"\ny: "+camera.position.y.toFixed(3)
								+"\nz: "+camera.position.z.toFixed(3)
								+"\nrot x : "+camera.rotation.x.toFixed(3)
								+"\nrot y : "+camera.rotation.y.toFixed(3)
								+"\nrot z : "+camera.rotation.z.toFixed(3));
				 }

			});

		</script>
	</body>
</html>
